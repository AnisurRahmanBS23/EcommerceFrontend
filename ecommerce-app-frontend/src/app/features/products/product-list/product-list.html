<div class="product-list-container">
  <p-toast></p-toast>

  <!-- Top Search Section -->
  <div class="search-section">
    <div class="search-wrapper">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input type="text" pInputText placeholder="Search for products..." [formControl]="searchControl"
          class="search-input" />
      </span>
      <button pButton type="button" [icon]="filtersVisible ? 'pi pi-times' : 'pi pi-filter'"
        [label]="filtersVisible ? 'Hide Filters' : 'Show Filters'" class="filter-toggle-btn"
        (click)="toggleFilters()"></button>
    </div>
  </div>

  <!-- Collapsible Filters Bar -->
  @if (filtersVisible) {
  <div class="filters-bar">
    <div class="filters-content">
      <!-- Sort Filter -->
      <div class="filter-item">
        <label class="filter-label">
          <i class="pi pi-sort-alt"></i>
          Sort By
        </label>
        <p-select [options]="sortOptions" [(ngModel)]="selectedSort" optionLabel="label" optionValue="value"
          placeholder="Select sorting" (onChange)="onSortChange()" [style]="{'width': '100%'}"></p-select>
      </div>

      <!-- Stock Filter -->
      <div class="filter-item">
        <label class="filter-label">
          <i class="pi pi-box"></i>
          Availability
        </label>
        <p-selectButton [options]="stockOptions" [(ngModel)]="inStockOnly" optionLabel="label" optionValue="value"
          (onChange)="onStockFilterChange()" styleClass="stock-toggle"></p-selectButton>
      </div>

      <!-- Price Range Filter -->
      <div class="filter-item price-filter">
        <label class="filter-label">
          <i class="pi pi-dollar"></i>
          Price Range
        </label>
        <div class="price-inputs">
          <p-inputNumber [(ngModel)]="minPrice" mode="currency" currency="BDT" locale="en-US" [min]="0"
            placeholder="Min"></p-inputNumber>
          <span class="price-separator">-</span>
          <p-inputNumber [(ngModel)]="maxPrice" mode="currency" currency="BDT" locale="en-US" [min]="0"
            placeholder="Max"></p-inputNumber>
          <button pButton type="button" icon="pi pi-check" class="apply-price-btn" (click)="applyPriceFilter()"
            pTooltip="Apply"></button>
        </div>
      </div>

      <!-- Clear Filters -->
      <div class="filter-item">
        <button pButton type="button" label="Clear All" icon="pi pi-times" class="p-button-outlined clear-btn"
          (click)="clearFilters()"></button>
      </div>
    </div>
  </div>
  }

  <!-- Main Content -->
  <div class="content-wrapper">
    <!-- Results Header -->
    <div class="results-header">
      <span class="results-count">
        <i class="pi pi-list"></i>
        {{ products.length }} Products Found
      </span>
    </div>

    <!-- Loading State -->
    @if (loading) {
    <div class="products-grid">
      @for (item of [1,2,3,4,5,6,7,8,9,10,11,12]; track item) {
      <div class="product-card">
        <p-skeleton width="100%" height="200px"></p-skeleton>
        <div class="p-mt-2">
          <p-skeleton width="80%" height="1.5rem"></p-skeleton>
          <p-skeleton width="60%" height="1rem" styleClass="p-mt-2"></p-skeleton>
          <p-skeleton width="40%" height="1rem" styleClass="p-mt-2"></p-skeleton>
        </div>
      </div>
      }
    </div>
    }

    <!-- Products Grid -->
    @if (!loading && products.length > 0) {
    <div class="products-grid">
      @for (product of products; track product.id) {
      <div class="product-card">
        <div class="product-image-wrapper" (click)="viewProductDetail(product.id)">
          @if (product.imageUrl) {
          <img [src]="product.imageUrl" [alt]="product.name" class="product-image" (error)="onImageError($event)" />
          } @else {
          <div class="no-image"
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); z-index: 1;">
            <i class="pi pi-shopping-bag" style="font-size: 6rem; color: #adb5bd;"></i>
            <span style="font-size: 1rem; color: #6c757d; font-weight: 500; margin-top: 1rem;">Image not
              available</span>
          </div>
          }

          <!-- Stock Badge -->
          <p-tag [value]="getStockLabel(product.stock)" [severity]="getStockSeverity(product.stock)"
            class="stock-badge"></p-tag>
        </div>

        <div class="product-details">
          <h3 class="product-name" (click)="viewProductDetail(product.id)">
            {{ product.name }}
          </h3>

          <p class="product-description">
            {{ product.description | slice:0:80 }}{{ product.description.length > 80 ? '...' : '' }}
          </p>

          <div class="product-footer">
            <span class="product-price">à§³{{ product.price | number:'1.2-2' }}</span>

            <button pButton type="button" icon="pi pi-shopping-cart" label="Add to Cart" class="p-button-sm"
              [disabled]="product.stock <= 0" (click)="addToCart(product)"></button>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Paginator -->
    @if (!loading && products.length > 0) {
    <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="pageSize" [totalRecords]="totalRecords"
      [rowsPerPageOptions]="[12, 24, 36]" styleClass="mt-4">
    </p-paginator>
    }

    <!-- Empty State -->
    @if (!loading && products.length === 0) {
    <div class="empty-state">
      <i class="pi pi-inbox empty-icon"></i>
      <h3>No Products Found</h3>
      <p>Try adjusting your search or filters</p>
      <button pButton type="button" label="Clear All Filters" icon="pi pi-refresh" class="p-button-outlined"
        (click)="clearFilters()"></button>
    </div>
    }
  </div>
</div>