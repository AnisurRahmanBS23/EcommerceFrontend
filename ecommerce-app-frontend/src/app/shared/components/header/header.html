<p-toolbar styleClass="custom-toolbar">
  <ng-template pTemplate="left">
    <div class="flex align-items-center gap-3">
      <a routerLink="/products" class="text-2xl font-bold text-primary no-underline cursor-pointer">
        <i class="pi pi-shopping-cart mr-2"></i>
        E-Shop
      </a>

      <!-- Mode Indicator Badge (visible for admins) -->
      @if (canSwitchMode() && isAuthenticated()) {
      <p-tag [value]="getModeBadgeLabel()" [severity]="getModeBadgeSeverity()"
        [icon]="currentMode === 'admin' ? 'pi pi-shield' : 'pi pi-user'" styleClass="mode-badge">
      </p-tag>
      }

      <!-- Navigation based on current mode -->
      @if (currentMode === 'customer') {
      <p-button label="Products" icon="pi pi-list" [text]="true" (onClick)="navigateToProducts()">
      </p-button>
      } @else {
      <p-button label="Dashboard" icon="pi pi-home" [text]="true" (onClick)="router.navigate(['/admin/dashboard'])">
      </p-button>
      }
    </div>
  </ng-template>

  <ng-template pTemplate="right">
    <div class="flex align-items-center gap-2">
      <!-- Mode Switcher (for admins/managers only) -->
      @if (canSwitchMode() && isAuthenticated()) {
      <p-selectButton [(ngModel)]="currentMode" [options]="modeOptions" (onChange)="onModeChange($event)"
        optionLabel="label" optionValue="value" styleClass="mode-switcher">
        <ng-template let-item pTemplate>
          <i [class]="item.icon"></i>
          <span class="ml-2">{{ item.label }}</span>
        </ng-template>
      </p-selectButton>
      }

      <!-- Test Notification Button (Temporary) -->
      <p-button icon="pi pi-bell" [text]="true" (onClick)="testNotification()" pTooltip="Test Notification"
        tooltipPosition="bottom">
      </p-button>

      <!-- Wishlist Button -->
      <p-button icon="pi pi-heart" [text]="true" [badge]="wishlistItemCount().toString()" badgeClass="p-badge-danger"
        (onClick)="navigateToWishlist()" pTooltip="Wishlist" tooltipPosition="bottom">
      </p-button>

      <!-- Cart Button -->
      <p-button icon="pi pi-shopping-cart" [text]="true" [badge]="cartItemCount().toString()"
        badgeClass="p-badge-danger" (onClick)="navigateToCart()" pTooltip="View Cart" tooltipPosition="bottom">
      </p-button>

      <!-- Authenticated User Menu -->
      <ng-container *ngIf="isAuthenticated(); else guestButtons">
        <p-menu #userMenu [model]="userMenuItems" [popup]="true" appendTo="body">
        </p-menu>

        <p-button icon="pi pi-user" [text]="true" (onClick)="userMenu.toggle($event)" pTooltip="Account"
          tooltipPosition="bottom">
        </p-button>
      </ng-container>

      <!-- Guest Buttons -->
      <ng-template #guestButtons>
        <p-button label="Login" icon="pi pi-sign-in" [text]="true" (onClick)="navigateToLogin()">
        </p-button>
        <p-button label="Register" icon="pi pi-user-plus" [outlined]="true" (onClick)="navigateToRegister()">
        </p-button>
      </ng-template>
    </div>
  </ng-template>
</p-toolbar>